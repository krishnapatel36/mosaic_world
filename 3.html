<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Mosaic Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Prevent overflow */
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        #matrixSizeValue {
            font-weight: bold;
        }
        canvas {
            border: 1px solid #ddd;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%; /* Ensure canvas doesn't overflow */
            height: auto; /* Maintain aspect ratio */
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:focus {
            outline: none;
        }
        #displayImage {
            border: 1px solid #ddd;
            margin-top: 20px;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dice Mosaic Generator by CCL, IIT Gandhinagar</h1>
        <div>
            <label for="matrixSize">Select matrix size:</label>
            <input type="range" id="matrixSize" min="10" max="100" value="40">
            <span id="matrixSizeValue">40</span>
            <br>
            <img id="displayImage" alt="Selected Image">
        </div>
        <button id="generateButton">Generate</button>
        <canvas id="outputCanvas"></canvas>
        <button id="downloadButton" style="display: none;">Download PDF</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        const { jsPDF } = window.jspdf;

        const dieImages = [
            'DiceImages/1.png',
            'DiceImages/2.png',
            'DiceImages/3.png',
            'DiceImages/4.png',
            'DiceImages/5.png',
            'DiceImages/6.png'
        ];

        let diceImages = [];

        async function preloadAssets() {
            try {
                diceImages = await Promise.all(dieImages.map(src => loadImage(src)));
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = src;
                img.onload = () => resolve(img);
                img.onerror = reject;
            });
        }

        preloadAssets();

        function updateMatrixSize() {
            document.getElementById('matrixSizeValue').textContent = document.getElementById('matrixSize').value;
        }

        document.getElementById('matrixSize').addEventListener('input', updateMatrixSize);
        updateMatrixSize();

        function getImageUrlFromParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('image');
        }

        const imageUrl = getImageUrlFromParams();
        if (imageUrl) {
            const displayImage = document.getElementById('displayImage');
            displayImage.src = imageUrl;
        }

        let generatedPdf = null;

        // Rolling animation for all dice
        async function rollAllDiceAnimation(matrixSize) {
            const rollCount = 30; // Number of frames for the animation
            const canvas = document.getElementById('outputCanvas');
            const ctx = canvas.getContext('2d');
            const finalValues = Array(matrixSize * matrixSize).fill(0); // Array to hold final dice values

            // Set canvas dimensions for the mosaic
            canvas.width = matrixSize * diceImages[0].width;
            canvas.height = matrixSize * diceImages[0].height;

            for (let frame = 0; frame < rollCount; frame++) {
                // Clear canvas for each frame
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < matrixSize * matrixSize; i++) {
                    // Random face value between 1 and 6
                    const faceValue = Math.floor(Math.random() * 6) + 1;
                    finalValues[i] = faceValue; // Store the random face value

                    // Draw the current dice face
                    const x = (i % matrixSize) * diceImages[0].width;
                    const y = Math.floor(i / matrixSize) * diceImages[0].height;
                    ctx.drawImage(diceImages[faceValue - 1], x, y, diceImages[0].width, diceImages[0].height);
                }

                await new Promise(resolve => setTimeout(resolve, 100)); // Delay for animation
            }

            // Show final values
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < matrixSize * matrixSize; i++) {
                const x = (i % matrixSize) * diceImages[0].width;
                const y = Math.floor(i / matrixSize) * diceImages[0].height;
                ctx.drawImage(diceImages[finalValues[i] - 1], x, y, diceImages[0].width, diceImages[0].height);
            }

            return finalValues; // Return the final face values
        }

        document.getElementById('generateButton').addEventListener('click', async () => {
            const matrixSize = parseInt(document.getElementById('matrixSize').value);
            const finalValues = await rollAllDiceAnimation(matrixSize); // Roll all dice and get final values

            // Generate the mosaic after the dice roll
            if (!imageUrl) {
                alert('No image URL provided.');
                return;
            }

            const img = new Image();
            img.src = imageUrl;

            img.onload = () => {
                const canvas = document.getElementById('outputCanvas');
                const ctx = canvas.getContext('2d');

                const resizedImage = document.createElement('canvas');
                const resizedCtx = resizedImage.getContext('2d');
                resizedImage.width = matrixSize;
                resizedImage.height = matrixSize;
                resizedCtx.drawImage(img, 0, 0, resizedImage.width, resizedImage.height);

                const imgData = resizedCtx.getImageData(0, 0, resizedImage.width, resizedImage.height);
                const data = imgData.data;

                const diceValues = [];
                for (let i = 0; i < data.length; i += 4) {
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    let dieIndex;
                    if (avg < 42) dieIndex = 0;
                    else if (avg < 84) dieIndex = 1;
                    else if (avg < 126) dieIndex = 2;
                    else if (avg < 168) dieIndex = 3;
                    else if (avg < 210) dieIndex = 4;
                    else dieIndex = 5;

                    diceValues.push(dieIndex + 1); // Store the dice face value (1-6)
                    ctx.drawImage(diceImages[dieIndex], (i / 4) % matrixSize * diceImages[0].width, Math.floor(i / (4 * matrixSize)) * diceImages[0].height);
                }

                // Format the dice faces into a grid text
                let textGrid = '';
                for (let i = 0; i < diceValues.length; i++) {
                    textGrid += diceValues[i] + ' ';
                    if ((i + 1) % matrixSize === 0) textGrid += '\n';
                }

                // Create the PDF but do not download it yet
                generatedPdf = new jsPDF();
                const lines = textGrid.split('\n');
                let y = 10;
                let pageHeight = generatedPdf.internal.pageSize.height;

                lines.forEach(line => {
                    if (y + 10 > pageHeight) { // If the next line will exceed the page, add a new page
                        generatedPdf.addPage();
                        y = 10;
                    }
                    generatedPdf.text(line, 10, y);
                    y += 10;
                });

                // Show the download button after generating the PDF
                document.getElementById('downloadButton').style.display = 'inline-block';
            };
        });

        document.getElementById('downloadButton').addEventListener('click', () => {
            if (generatedPdf) {
                generatedPdf.save('dice_mosaic.pdf');
            } else {
                alert('Please generate the PDF first.');
            }
        });
    </script>
</body>
</html> -->
<!-- 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Mosaic Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Prevent overflow */
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        #matrixSizeValue {
            font-weight: bold;
        }
        canvas {
            border: 1px solid #ddd;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%; /* Ensure canvas doesn't overflow */
            height: auto; /* Maintain aspect ratio */
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:focus {
            outline: none;
        }
        #displayImage {
            border: 1px solid #ddd;
            margin-top: 20px;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dice Mosaic Generator by CCL, IIT Gandhinagar</h1>
        <div>
            <label for="matrixSize">Select matrix size:</label>
            <input type="range" id="matrixSize" min="10" max="100" value="40">
            <span id="matrixSizeValue">40</span>
            <br>
            <img id="displayImage" alt="Selected Image">
        </div>
        <button id="generateButton">Generate</button>
        <button id="downloadButton" style="display: none;">Download PDF</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        const { jsPDF } = window.jspdf;

        function updateMatrixSize() {
            document.getElementById('matrixSizeValue').textContent = document.getElementById('matrixSize').value;
        }

        document.getElementById('matrixSize').addEventListener('input', updateMatrixSize);
        updateMatrixSize();

        function getImageUrlFromParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('image');
        }

        const imageUrl = getImageUrlFromParams();
        if (imageUrl) {
            const displayImage = document.getElementById('displayImage');
            displayImage.src = imageUrl;
        }

        let generatedPdf = null;

        async function generatePDF(matrixSize) {
            if (!imageUrl) {
                alert('No image URL provided.');
                return;
            }

            const img = new Image();
            img.src = imageUrl;

            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = matrixSize;
                canvas.height = matrixSize;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;

                const diceValues = [];
                for (let i = 0; i < data.length; i += 4) {
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    let dieIndex;
                    if (avg < 42) dieIndex = 0;
                    else if (avg < 84) dieIndex = 1;
                    else if (avg < 126) dieIndex = 2;
                    else if (avg < 168) dieIndex = 3;
                    else if (avg < 210) dieIndex = 4;
                    else dieIndex = 5;

                    diceValues.push(dieIndex + 1); // Store the dice face value (1-6)
                }

                // Format the dice faces into a grid text
                let textGrid = '';
                for (let i = 0; i < diceValues.length; i++) {
                    textGrid += diceValues[i] + ' ';
                    if ((i + 1) % matrixSize === 0) textGrid += '\n';
                }

                // Create the PDF but do not download it yet
                generatedPdf = new jsPDF();
                const lines = textGrid.split('\n');
                let y = 10;
                let pageHeight = generatedPdf.internal.pageSize.height;

                lines.forEach(line => {
                    if (y + 10 > pageHeight) { // If the next line will exceed the page, add a new page
                        generatedPdf.addPage();
                        y = 10;
                    }
                    generatedPdf.text(line, 10, y);
                    y += 10;
                });

                // Show the download button after generating the PDF
                document.getElementById('downloadButton').style.display = 'inline-block';
            };
        }

        document.getElementById('generateButton').addEventListener('click', async () => {
            const matrixSize = parseInt(document.getElementById('matrixSize').value);
            await generatePDF(matrixSize); // Generate the PDF
        });

        document.getElementById('downloadButton').addEventListener('click', () => {
            if (generatedPdf) {
                generatedPdf.save('dice_mosaic.pdf');
            } else {
                alert('Please generate the PDF first.');
            }
        });
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Mosaic Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Prevent overflow */
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        #matrixSizeValue {
            font-weight: bold;
        }
        canvas {
            border: 1px solid #ddd;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%; /* Ensure canvas doesn't overflow */
            height: auto; /* Maintain aspect ratio */
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:focus {
            outline: none;
        }
        #displayImage {
            border: 1px solid #ddd;
            margin-top: 20px;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dice Mosaic Generator by CCL, IIT Gandhinagar</h1>
        <div>
            <label for="matrixSize">Select matrix size:</label>
            <input type="range" id="matrixSize" min="10" max="100" value="40">
            <span id="matrixSizeValue">40</span>
            <br>
            <img id="displayImage" alt="Selected Image">
        </div>
        <button id="generateButton">Generate</button>
        <button id="downloadButton" style="display: none;">Download PDF</button>
        <button id="gif" style="display: none;">See Gif</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        const { jsPDF } = window.jspdf;

        function updateMatrixSize() {
            document.getElementById('matrixSizeValue').textContent = document.getElementById('matrixSize').value;
        }

        document.getElementById('matrixSize').addEventListener('input', updateMatrixSize);
        updateMatrixSize();

        function getImageUrlFromParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('image');
        }

        const imageUrl = getImageUrlFromParams();
        if (imageUrl) {
            const displayImage = document.getElementById('displayImage');
            displayImage.src = imageUrl;
        }

        let generatedPdf = null;

        async function generatePDF(matrixSize) {
            if (!imageUrl) {
                alert('No image URL provided.');
                return;
            }

            const img = new Image();
            img.src = imageUrl;

            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = matrixSize;
                canvas.height = matrixSize;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;

                const diceValues = [];
                for (let i = 0; i < data.length; i += 4) {
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    let dieIndex;
                    if (avg < 42) dieIndex = 0;
                    else if (avg < 84) dieIndex = 1;
                    else if (avg < 126) dieIndex = 2;
                    else if (avg < 168) dieIndex = 3;
                    else if (avg < 210) dieIndex = 4;
                    else dieIndex = 5;

                    diceValues.push(dieIndex + 1); // Store the dice face value (1-6)
                }


               

                // Format the dice faces into a grid text
                let textGrid = '';
                for (let i = 0; i < diceValues.length; i++) {
                    textGrid += diceValues[i] + ' ';
                    if ((i + 1) % matrixSize === 0) textGrid += '\n';
                }

                // Create the PDF but do not download it yet
                generatedPdf = new jsPDF();
                const lines = textGrid.split('\n');
                let y = 10;
                let pageHeight = generatedPdf.internal.pageSize.height;

                lines.forEach(line => {
                    if (y + 10 > pageHeight) { // If the next line will exceed the page, add a new page
                        generatedPdf.addPage();
                        y = 10;
                    }
                    generatedPdf.text(line, 10, y);
                    y += 10;
                });

                // Show the download button after generating the PDF
                document.getElementById('downloadButton').style.display = 'inline-block';
            };
        }

        document.getElementById('generateButton').addEventListener('click', async () => {
            const matrixSize = parseInt(document.getElementById('matrixSize').value);
            await generatePDF(matrixSize); // Generate the PDF
        });

        document.getElementById('downloadButton').addEventListener('click', () => {
            if (generatedPdf) {
                generatedPdf.save('dice_mosaic.pdf');
            } else {
                alert('Please generate the PDF first.');
            }
        });
    </script>
</body>
</html>
 -->

 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Dice Mosaic Generator</title>
     <style>
         body {
             font-family: Arial, sans-serif;
             text-align: center;
             padding: 20px;
             background-color: #f5f5f5;
         }
         .container {
             max-width: 1000px;
             margin: auto;
             padding: 20px;
             background: white;
             border-radius: 8px;
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
             overflow: hidden;
         }
         input[type="range"] {
             width: 100%;
             margin: 10px 0;
         }
         #matrixSizeValue {
             font-weight: bold;
         }
         canvas {
             border: 1px solid #ddd;
             margin-top: 20px;
             display: block;
             margin-left: auto;
             margin-right: auto;
             max-width: 100%;
             height: auto;
         }
         button {
             background-color: #007bff;
             color: white;
             border: none;
             border-radius: 4px;
             padding: 10px 20px;
             font-size: 16px;
             cursor: pointer;
             margin: 10px;
         }
         button:hover {
             background-color: #0056b3;
         }
         button:focus {
             outline: none;
         }
         #displayImage {
             border: 1px solid #ddd;
             margin-top: 20px;
             max-width: 100%;
             height: auto;
         }
     </style>
 </head>
 <body>
     <div class="container">
         <h1>Dice Mosaic Generator by CCL, IIT Gandhinagar</h1>
         <div>
             <label for="matrixSize">Select matrix size:</label>
             <input type="range" id="matrixSize" min="10" max="100" value="40">
             <span id="matrixSizeValue">40</span>
             <br>
             <img id="displayImage" alt="Selected Image">
         </div>
         <button id="generateButton">Generate</button>
         <button id="downloadButton" style="display: none;">Download PDF</button>
         <button id="seeGifButton" style="display: none;">See Gif</button>
     </div>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 
     <script>
         const { jsPDF } = window.jspdf;
 
         function updateMatrixSize() {
             document.getElementById('matrixSizeValue').textContent = document.getElementById('matrixSize').value;
         }
 
         document.getElementById('matrixSize').addEventListener('input', updateMatrixSize);
         updateMatrixSize();
 
         function getImageUrlFromParams() {
             const params = new URLSearchParams(window.location.search);
             return params.get('image');
         }
 
         const imageUrl = getImageUrlFromParams();
         if (imageUrl) {
             const displayImage = document.getElementById('displayImage');
             displayImage.src = imageUrl;
         }
 
         let generatedPdf = null;
         let diceValues = [];
         let matrixSize = 40;
 
         async function generatePDF(matrixSize) {
             if (!imageUrl) {
                 alert('No image URL provided.');
                 return;
             }
 
             const img = new Image();
             img.src = imageUrl;
 
             img.onload = () => {
                 const canvas = document.createElement('canvas');
                 const ctx = canvas.getContext('2d');
                 canvas.width = matrixSize;
                 canvas.height = matrixSize;
                 ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
 
                 const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                 const data = imgData.data;
 
                 diceValues = [];
                 for (let i = 0; i < data.length; i += 4) {
                     const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                     let dieIndex;
                     if (avg < 42) dieIndex = 0;
                     else if (avg < 84) dieIndex = 1;
                     else if (avg < 126) dieIndex = 2;
                     else if (avg < 168) dieIndex = 3;
                     else if (avg < 210) dieIndex = 4;
                     else dieIndex = 5;
 
                     diceValues.push(dieIndex + 1);
                 }
                 let textGrid = '';
                 for (let i = 0; i < diceValues.length; i++) {
                     textGrid += diceValues[i] + ' ';
                     if ((i + 1) % matrixSize === 0) textGrid += '\n';
                 }
 
                 generatedPdf = new jsPDF();
                 const lines = textGrid.split('\n');
                 let y = 10;
                 let pageHeight = generatedPdf.internal.pageSize.height;
 
                 lines.forEach(line => {
                     if (y + 10 > pageHeight) {
                         generatedPdf.addPage();
                         y = 10;
                     }
                     generatedPdf.text(line, 10, y);
                     y += 10;
                 });
 
                 document.getElementById('downloadButton').style.display = 'inline-block';
                 document.getElementById('seeGifButton').style.display = 'inline-block';
             };
         }
 
         document.getElementById('generateButton').addEventListener('click', async () => {
             matrixSize = parseInt(document.getElementById('matrixSize').value);
             await generatePDF(matrixSize);
         });
 
         document.getElementById('downloadButton').addEventListener('click', () => {
             if (generatedPdf) {
                 generatedPdf.save('dice_mosaic.pdf');
             } else {
                 alert('Please generate the PDF first.');
             }
         });
 
         document.getElementById('seeGifButton').addEventListener('click', () => {
             if (diceValues.length > 0 && matrixSize > 0) {
                 const queryParams = new URLSearchParams({
                     diceValues: JSON.stringify(diceValues),
                     matrixSize: matrixSize
                 });
                 window.open('p5.html?' + queryParams.toString(), '_blank');
             } else {
                 alert('Please generate the PDF first.');
             }
         });
     </script>
 </body>
 </html>
 
